 # Web 视频转 APNG 转换器

这是一个基于 Web 的工具，允许用户上传视频文件，通过服务器端的 FFmpeg 将其转换为动画 PNG (APNG) 格式，并提供打包下载结果的功能。

## 主要功能

-   **视频上传**: 支持通过文件选择器或拖拽方式上传一个或多个视频文件。
-   **格式转换**: 调用本地安装的 FFmpeg 将视频转换为 APNG 格式。
-   **自定义帧率 (FPS)**: 用户可以选择使用默认帧率 (15 FPS) 或指定自定义帧率进行转换。
-   **文件列表管理**:
    -   清晰展示已选择的文件列表（包括文件名和大小）。
    -   支持移除列表中的单个文件。
    -   支持一键清空整个文件列表。
-   **输入验证**: 自定义 FPS 输入框只接受正整数。
-   **异步处理**: 后端使用 FastAPI 的后台任务处理耗时的转换过程，避免阻塞。
-   **状态轮询**: 前端实时轮询后端获取转换进度和状态。
-   **结果下载**: 转换完成后，提供打包好的 ZIP 文件下载所有成功的 APNG 结果。
-   **错误处理**: 显示转换失败的文件及原因。

## 系统需求

-   **Python**: 3.9 或更高版本 (因为使用了 `asyncio.to_thread`)。
-   **FFmpeg**: 必须已安装在运行后端的服务器上，并且其可执行文件路径已添加到系统的 `PATH` 环境变量中。可以通过在终端运行 `ffmpeg -version` 来检查。
    -   **注意**: 虽然 FFmpeg 体积较大，但强烈建议使用官方发布的**完整版本**，而不是尝试自行编译精简版。完整版能确保最佳的兼容性、稳定性和未来的灵活性。FFmpeg 仅需在后端服务器安装一次。

## 安装与设置

1.  **克隆仓库**:

2.  **设置后端环境**:
    ```bash
    cd backend
    # 创建虚拟环境 (推荐)
    python -m venv venv
    # 激活虚拟环境
    # Windows:
    venv\Scripts\activate
    # macOS/Linux:
    # source venv/bin/activate

    # 安装依赖
    pip install -r requirements.txt
    cd ..
    ```

## 运行应用

1.  **启动后端服务器**:
    *   确保您位于项目根目录 (`web_apng_converter`) 下。
    *   进入 `backend` 目录并激活虚拟环境（如果已创建）。
    *   运行 FastAPI 应用:
        ```bash
        cd backend
        uvicorn main:app --reload --host 0.0.0.0 --port 8000
        ```
        服务器将在 `http://0.0.0.0:8000` 上运行。

2.  **访问前端**:
    *   在您的网页浏览器中打开以下地址之一：
        *   `http://localhost:8000`
        *   `http://127.0.0.1:8000`

## 如何使用

1.  **选择文件**: 点击“点击选择文件”按钮或将视频文件拖拽到虚线框区域。您可以选择或拖拽多个文件。
2.  **管理文件列表**:
    *   查看已选择的文件及其大小。
    *   点击文件旁边的 '❌' 按钮移除单个文件。
    *   点击“清空列表”按钮移除所有已选文件。
3.  **设置帧率 (可选)**:
    *   默认使用 15 FPS。
    *   勾选“自定义帧率”复选框，然后在输入框中输入您想要的正整数帧率（例如 30）。
4.  **开始转换**: 点击“开始转换”按钮。
5.  **查看状态**: 转换过程中会显示进度条和状态信息。如果出现错误，会显示失败详情。
6.  **下载结果**: 转换完成后，如果至少有一个文件成功转换，将出现“下载成功结果 (ZIP)”的链接。点击即可下载包含所有成功 APNG 文件的 ZIP 压缩包。

## 项目结构

```
web_apng_converter/
├── backend/
│   ├── converter.py       # 核心转换逻辑 (调用 FFmpeg)
│   ├── main.py            # FastAPI 应用, API 路由, 后台任务
│   ├── requirements.txt   # Python 依赖
│   └── venv/              # Python 虚拟环境 (可选)
├── frontend/
│   ├── index.html         # 前端页面结构
│   ├── style.css          # 前端页面样式
│   └── script.js          # 前端页面逻辑 (与后端 API 交互)
├── temp_files/            # 临时文件存储 (运行时自动创建)
│   ├── uploads/           # 存储上传的视频
│   └── results/           # 存储转换后的 APNG 和打包的 ZIP
├── README.md              # 本文件
└── web_apng_converter_task.md # 开发过程中的任务跟踪文件 (可选保留)
```

## 注意事项

-   转换所需时间和资源取决于视频的大小、时长、数量以及服务器性能。
-   生成的 APNG 文件可能会比较大，特别是对于长视频或高帧率。
-   请确保运行后端的服务器有足够的磁盘空间来存储临时上传的文件和转换结果。
-   某些平台（如特定社交媒体或论坛）可能对 APNG 文件有尺寸或大小限制，请根据需要检查输出文件。
